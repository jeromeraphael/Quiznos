<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <title>The General Quiz That No One Asked For</title>

    <script src="script.js"></script>
    <style>
        * {
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .center {
            margin: auto;
            display: table;   
        }

        .test-question-div {
            width: auto; 
        }

        .answer {
            position: relative; 
            display: table-cell; 
            width: 100%;
            height: 100%;  
        }

        td {
            position: relative; 
            width: 50%; 
        }

        button {
            font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; 
        }

    </style>
  </head>

  <body>
    <main>
      <div id="homepage" class='center'>
        <h1>QUIZKNOWS</h1>
        <div id="categories">
            <p><a class='center' href="/play">HOME</a></p>
        </div>
      </div>
      <button id="start-quiz-button" class='center' onclick="loadQuizQuestions()">start quiz</button>
      <div id="test-question-div" class="center"></div>
    <script text="text/javascript">
        var quizId = 1;
        var userId = localStorage.getItem('userId');
        var score = 0; 
        var questionsAnswered = 0; 

        const loadQuizQuestions = () => {
            document.getElementById('start-quiz-button').style.display = 'none'; 
            fetch('/general/questions', {
                credentials: "same-origin", 
                headers: {
                    'Content-Type': 'application/json'
                }
            })
              .then(questions => questions.json())
              .then(questions => { 
                localStorage.setItem('questions', JSON.stringify(questions)); 
                console.log(questions); 
                for (let i = 0; i < 5; i++) { 
                    let question = questions[i];
                    let testQuestionDiv = document.getElementById('test-question-div');  
                    let html = `<div id='question-${i}-container' class='question-container center'>
                        <span class='question-text center'>${question['questionText']}</span>
                            <table class='button-table center'>
                            <tbody>
                                <tr>
                                    <td><button class='answer1 answer question-${i}'>${question['answer1']}</button></td><td><button class='answer2 answer question-${i}'>${question['answer2']}</button></td>
                                </tr>
                                <tr>
                                    <td><button class='answer3 answer question-${i}'>${question['answer3']}</button></td><td><button class='answer4 answer question-${i}'>${question['answer4']}</button></td>
                                </tr>
                            </tbody>
                            </table>
                            <br>`; 
                    testQuestionDiv.insertAdjacentHTML('beforeend', html);
                    let answers = document.getElementsByClassName(`question-${i}`);
                    for (let j = 0; j < 4; j++) {
                        let button = testQuestionDiv.lastChild.getElementsByTagName('button')[j];
                        if (button.innerHTML === question['correctAnswer']) {
                            button.addEventListener('click', () => {
                                score += 1;
                                button.style.backgroundColor = 'green';
                                alert('correct answer');
                            });
                        }
                        else {
                            button.addEventListener('click', () => {
                                button.style.backgroundColor = 'red'
                                alert('incorrect answer');
                            }); 
                        }
                        button.addEventListener('click', () => {
                            for (let k = 0; k < 4; k++) {
                                document.getElementsByClassName(`question-${i}`)[k].disabled = true;
                                questionsAnswered += 1;
                                checkForQuizCompletion();   
                            }
                        });
                    }
                }  
            });
        }

        const checkForQuizCompletion = () => {
            if (questionsAnswered === 5) {
                document.getElementById('test-question-div').insertAdjacentHTML('<button class="center" onclick="saveScore()">save score </button>'); 
            }
        }

    </script>
      
    </main>
  </body>
</html>